<section class="home">
  <div class="cart-floating-btn" (click)="openCart()">
    <nz-badge [nzCount]="cartItems.length">
      <button nz-button nzType="primary" nzShape="circle" class="cart-main-button">
        <span nz-icon nzType="shopping-cart"></span>
      </button>
    </nz-badge>
  </div>

  <div class="hero-galaxy">
    <div class="hero-container">
      <div class="hero-text-content">
        <span class="brand-tag">PINNACLE STORE</span>
        <h1 class="main-welcome">Welcome</h1>
        <p class="main-subtitle">Find the perfect gift for every occasion with our exclusive selection.</p>
        <button nz-button nzType="primary" class="btn-shop-now" (click)="goToProductsPage()">
          Shop Now <span nz-icon nzType="arrow-right"></span>
        </button>
      </div>

      <div class="hero-visual-content">
        <div class="product-platform">
          <img src="assets/products/play5slim.png" alt="PS5" class="hero-ps5-img">
          <div class="platform-light"></div>
        </div>
        <span class="ultra-tag">ULTRA HD GAMING</span>
      </div>
    </div>
    <div class="space-nebula"></div>
  </div>

  <div class="products-section">
    <div class="section-header">
      <div class="title-group">
        <h2 class="section-title">Popular Products</h2>
        <div class="title-bar"></div>
      </div>
      <button nz-button nzType="default" class="btn-view-all" (click)="goToProductsPage()">
        Ver todos los productos <span nz-icon nzType="arrow-right"></span>
      </button>
    </div>

    <div class="product-grid">
      @for (product of products; track product.id) {
      <div class="product-card-premium">
        <div class="img-box" (click)="verDetalle(product)">
          <img [src]="product.imageUrl || 'assets/logo.png'" />
        </div>
        <div class="info-box">
          <div class="rating-box">
            <span class="stars">★★★★★</span>
            <span class="reviews">1,240</span>
          </div>
          <h3 class="product-name">{{ product.name }}</h3>
          <p class="product-price">${{ product.price | number:'1.0-0' }}</p>
          <button nz-button class="btn-add-cart" (click)="addToCart(product)">
            Add to cart
          </button>
        </div>
      </div>
      }
    </div>
  </div>

  <nz-drawer [nzVisible]="isCartVisible" nzPlacement="right" [nzTitle]="drawerTitle" [nzClosable]="false"
    [nzMaskClosable]="true" (nzOnCancel)="closeCart()" [nzWidth]="400">

    <ng-template #drawerTitle>
      <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
        <span style="font-weight: 800; font-size: 1.2rem;">Tu Carrito</span>
        <button nz-button nzType="text" (click)="closeCart()">
          <span nz-icon nzType="close" style="font-size: 20px; color: #999;"></span>
        </button>
      </div>
    </ng-template>

    <ng-container *nzDrawerContent>
      <div style="display: flex; flex-direction: column; height: 100%;">
        <div style="flex: 1; overflow-y: auto; padding: 10px 0;">
          @if (cartItems.length === 0) {
          <div style="text-align: center; margin-top: 50px; color: #999;">
            <span nz-icon nzType="shopping-cart" style="font-size: 60px; opacity: 0.3;"></span>
            <p style="margin-top: 15px;">Tu carrito está vacío</p>
          </div>
          }

          @for (item of cartItems; track item.product.id) {
          <div class="cart-item-premium">
            <div class="cart-item-img">
              <img [src]="item.product.imageUrl || 'assets/logo.png'">
            </div>

            <div class="cart-item-info">
              <span class="cart-item-name">{{ item.product.name }}</span>
              <span class="cart-item-price">${{ item.product.price | number }}</span>

              <div class="quantity-pill-modern">
                <button *ngIf="item.quantity === 1" class="btn-qty-action" (click)="removeFromCart(item.product.id)">
                  <span nz-icon nzType="delete"></span>
                </button>

                <button *ngIf="item.quantity > 1" class="btn-qty-action" (click)="decreaseQuantity(item)">
                  <span nz-icon nzType="minus"></span>
                </button>

                <span class="qty-num">{{ item.quantity }}</span>

                <button class="btn-qty-action" (click)="increaseQuantity(item)">
                  <span nz-icon nzType="plus"></span>
                </button>
              </div>
            </div>
          </div>
          }
        </div>

        <div class="cart-footer-premium">
          <div class="subtotal-row">
            <span>Subtotal</span>
            <strong>${{ calculateTotal() | number }}</strong>
          </div>
          <button nz-button nzType="primary" nzBlock class="checkout-button" (click)="goToCartPage()">
            Continuar al Pago
          </button>
        </div>
      </div>
    </ng-container>
  </nz-drawer>
</section>