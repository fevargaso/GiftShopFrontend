<div class="admin-page">
  <div class="admin-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
    <h2>Gestión de Inventario</h2>
    <div class="action-buttons">
      <button nz-button nzType="default" (click)="isCategoryVisible = true" style="margin-right: 8px;">
        <span nz-icon nzType="tags"></span> Nueva Categoría
      </button>

      <button nz-button nzType="primary" (click)="showModal()">
        <span nz-icon nzType="plus"></span> Nuevo Producto
      </button>
    </div>
  </div>

  <nz-table #basicTable [nzData]="products" nzBordered [nzFrontPagination]="false"           
  [nzTotal]="totalItems"               
  [nzPageIndex]="pageIndex"            
  [nzPageSize]="pageSize"               
  (nzPageIndexChange)="onPageIndexChange($event)">
    <thead>
      <tr>
        <th nzWidth="100px">Imagen</th>
        <th>Nombre</th>
        <th>Precio</th>
        <th>Categoría</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let data of basicTable.data">
        <td style="text-align: center;">
          <img [src]="data.imageUrl || 'assets/logo.png'" 
               style="width: 50px; height: 50px; object-fit: contain; border-radius: 4px; border: 1px solid #eee;"
               (error)="$any($event.target).src = 'assets/logo.png'">
        </td>
        <td>
          <strong>{{ data.name }}</strong>
          <p style="font-size: 12px; color: #888; margin: 0;">{{ data.description }}</p>
        </td>
        <td>{{ data.price | number:'1.0-0' }}</td>
        <td>{{ data.categoryName }}</td>
        <td> <button nz-button nzType="link" (click)="showModal(data)">Editar</button>
          <button nz-button nzType="link" nzDanger (click)="deleteProduct(data.id)">Eliminar</button>
        </td>
      </tr>
    </tbody>
  </nz-table>
</div>

<nz-modal 
  [(nzVisible)]="isVisible" 
  [nzTitle]="isEdit ? 'Editar Producto' : 'Crear Nuevo Producto'" 
  (nzOnCancel)="handleCancel()" 
  (nzOnOk)="handleOk()"
>
  <ng-container *nzModalContent>
    <form nz-form nzLayout="vertical">
      <div style="display: flex; gap: 20px;">
        <div style="flex: 0 0 120px; text-align: center;">
            <p style="font-size: 12px; margin-bottom: 8px;">Vista previa</p>
            <img [src]="currentProduct.imageUrl || 'assets/logo.png'" 
                 style="width: 120px; height: 120px; object-fit: contain; border: 1px dashed #d9d9d9; border-radius: 8px;"
                 (error)="$any($event.target).src = 'assets/logo.png'">
        </div>

        <div style="flex: 1;">
          <nz-form-item>
            <nz-form-label>Nombre del Producto</nz-form-label>
            <nz-form-control>
              <input nz-input [(ngModel)]="currentProduct.name" name="name" placeholder="Ej: Laptop Gaming" />
            </nz-form-control>
          </nz-form-item>

          <nz-form-item>
            <nz-form-label>Imagen del Producto</nz-form-label>
            <nz-form-control>
              <div style="display: flex; flex-direction: column; gap: 8px;">
                <input type="file" #fileInput (change)="onFileSelected($event)" accept="image/*" style="display: none" />
                
                <button nz-button type="button" nzBlock (click)="fileInput.click()" style="border-radius: 4px;">
                  <span nz-icon nzType="upload"></span> {{ currentProduct.imageUrl ? 'Cambiar Foto' : 'Subir Foto Local' }}
                </button>

                <input nz-input [(ngModel)]="currentProduct.imageUrl" name="imageUrl" placeholder="O pega el link de la imagen aquí" style="font-size: 12px;" />
              </div>
            </nz-form-control>
          </nz-form-item>
        </div>
      </div>

      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
        <nz-form-item>
          <nz-form-label>Precio</nz-form-label>
          <nz-form-control>
            <input nz-input type="number" [(ngModel)]="currentProduct.price" name="price" />
          </nz-form-control>
        </nz-form-item>

        <nz-form-item>
          <nz-form-label nzRequired>Categoría</nz-form-label>
          <nz-form-control>
            <nz-select [(ngModel)]="currentProduct.categoryId" name="categoryId" nzPlaceHolder="Seleccione">
              <nz-option *ngFor="let cat of categories" [nzValue]="cat.id" [nzLabel]="cat.name"></nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
      </div>

      <nz-form-item>
        <nz-form-label>Descripción</nz-form-label>
        <nz-form-control>
          <textarea nz-input [(ngModel)]="currentProduct.description" name="description" rows="3"></textarea>
        </nz-form-control>
      </nz-form-item>
    </form>
  </ng-container>
</nz-modal>