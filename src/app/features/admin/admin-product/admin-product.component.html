<div class="admin-page">
  <div class="admin-header">
    <div class="header-left">
      <h2>Products Inventory</h2>

      <div class="controls-container">
        <nz-select
          class="filter-select"
          [(ngModel)]="params.category"
          (ngModelChange)="onCategoryChange($event)"
          nzPlaceHolder="All Categories"
          nzAllowClear
        >
          <nz-option *ngFor="let cat of categories" [nzValue]="cat.id" [nzLabel]="cat.name"></nz-option>
        </nz-select>

        <div class="search-wrapper">
          <input
            type="text"
            nz-input
            placeholder="Search by name..."
            [(ngModel)]="params.search"
            (ngModelChange)="onSearchChange($event)"
          />
          <button class="search-confirm-btn">
            <span nz-icon nzType="search"></span>
          </button>
        </div>

        <div class="show-per-page">
          <span>Show:</span>
          <nz-select class="page-size-select" [(ngModel)]="params.pageSize" (ngModelChange)="onPageSizeChange($event)">
            <nz-option [nzValue]="6" nzLabel="6 per page"></nz-option>
            <nz-option [nzValue]="10" nzLabel="10 per page"></nz-option>
            <nz-option [nzValue]="20" nzLabel="20 per page"></nz-option>
          </nz-select>
        </div>
      </div>
    </div>

    <div class="header-right">
      <button nz-button nzType="primary" class="btn-new" (click)="showModal()">
        <span nz-icon nzType="plus"></span> New Product
      </button>
    </div>
  </div>

  <div class="table-container">
    <nz-table
      #basicTable
      [nzData]="products"
      nzBordered
      [nzFrontPagination]="false"
      [nzTotal]="totalItems"
      [nzPageIndex]="params.page"
      [nzPageSize]="params.pageSize"
      (nzPageIndexChange)="onPageIndexChange($event)"
    >
      <thead>
        <tr>
          <th nzWidth="100px">Image</th>
          <th>Name</th>
          <th>Price</th>
          <th>Category</th>
          <th nzWidth="150px">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let data of basicTable.data">
          <td style="text-align: center">
            <img
              [src]="data.imageUrl || 'assets/logo.png'"
              class="product-img"
              (error)="$any($event.target).src = 'assets/logo.png'"
              style="width: 40px; height: 40px; object-fit: cover; border-radius: 4px"
            />
          </td>
          <td>
            <strong>{{ data.name }}</strong>
            <p style="font-size: 12px; color: #888; margin: 0">{{ data.description }}</p>
          </td>
          <td>{{ data.price | number: '1.0-0' }}</td>
          <td>{{ data.categoryName }}</td>
          <td>
            <button nz-button nzType="link" (click)="showModal(data)">Edit</button>
            <button nz-button nzType="link" nzDanger (click)="deleteProduct(data.id)">Delete</button>
          </td>
        </tr>
      </tbody>
    </nz-table>
  </div>

  <nz-modal
    [(nzVisible)]="isVisible"
    [nzTitle]="isEdit ? 'Edit Product' : 'New Product'"
    [nzWidth]="600"
    (nzOnCancel)="handleCancel()"
    (nzOnOk)="handleOk()"
  >
    <ng-container *nzModalContent>
      <div class="pro-modal-content">
        <form nz-form nzLayout="vertical" style="width: 100%">
          <div style="display: flex; gap: 30px">
            <div style="flex: 1">
              <div
                class="image-dropzone"
                (click)="fileInput.click()"
                style="
                  border: 1px dashed #d9d9d9;
                  border-radius: 8px;
                  height: 180px;
                  display: flex;
                  flex-direction: column;
                  align-items: center;
                  justify-content: center;
                  cursor: pointer;
                  background: #fafafa;
                  overflow: hidden;
                "
              >
                <img
                  *ngIf="currentProduct.imageUrl"
                  [src]="currentProduct.imageUrl"
                  class="preview-img"
                  style="max-width: 100%; max-height: 100%; object-fit: contain"
                />
                <div
                  *ngIf="!currentProduct.imageUrl"
                  class="upload-placeholder"
                  style="text-align: center; color: #8c8c8c"
                >
                  <span nz-icon nzType="cloud-upload" style="font-size: 32px"></span>
                  <p style="margin-top: 8px">Upload Image</p>
                </div>
                <input
                  #fileInput
                  type="file"
                  style="display: none"
                  (change)="onFileSelected($event)"
                  accept="image/*"
                />
              </div>

              <nz-form-item style="margin-top: 15px">
                <nz-form-control>
                  <input
                    nz-input
                    placeholder="Or paste image URL..."
                    [(ngModel)]="currentProduct.imageUrl"
                    name="imageUrl"
                  />
                </nz-form-control>
              </nz-form-item>
            </div>

            <div style="flex: 1.5">
              <nz-form-item>
                <nz-form-label nzRequired>Product Name</nz-form-label>
                <nz-form-control>
                  <input nz-input [(ngModel)]="currentProduct.name" name="name" placeholder="Enter product name" />
                </nz-form-control>
              </nz-form-item>

              <div style="display: flex; gap: 15px">
                <nz-form-item style="flex: 1">
                  <nz-form-label nzRequired>Category</nz-form-label>
                  <nz-form-control>
                    <nz-select
                      [(ngModel)]="currentProduct.categoryId"
                      name="categoryId"
                      nzPlaceHolder="Select category"
                    >
                      <nz-option *ngFor="let cat of categories" [nzValue]="cat.id" [nzLabel]="cat.name"></nz-option>
                    </nz-select>
                  </nz-form-control>
                </nz-form-item>

                <nz-form-item style="flex: 1">
                  <nz-form-label nzRequired>Price</nz-form-label>
                  <nz-form-control>
                    <input nz-input type="number" [(ngModel)]="currentProduct.price" name="price" />
                  </nz-form-control>
                </nz-form-item>
              </div>

              <nz-form-item>
                <nz-form-label>Description</nz-form-label>
                <nz-form-control>
                  <textarea
                    nz-input
                    rows="4"
                    [(ngModel)]="currentProduct.description"
                    name="description"
                    placeholder="Optional description"
                  ></textarea>
                </nz-form-control>
              </nz-form-item>
            </div>
          </div>
        </form>
      </div>
    </ng-container>
  </nz-modal>
</div>
